<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task & Communication Hub | EventHub</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0a1628;
      --bg-secondary: #132039;
      --bg-card: rgba(19, 32, 57, 0.7);
      --bg-card-hover: rgba(19, 32, 57, 0.9);
      --text-primary: #ffffff;
      --text-secondary: #a0aec0;
      --text-muted: #718096;
      --accent-pink: #e91e8c;
      --accent-purple: #9333ea;
      --accent-teal: #14b8a6;
      --border-color: rgba(255, 255, 255, 0.1);
      --success: #10b981;
      --warning: #f59e0b;
      --info: #3b82f6;
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    [data-theme="light"] {
      --bg-primary: #f7fafc;
      --bg-secondary: #edf2f7;
      --bg-card: rgba(255, 255, 255, 0.9);
      --bg-card-hover: rgba(255, 255, 255, 1);
      --text-primary: #1a202c;
      --text-secondary: #4a5568;
      --text-muted: #718096;
      --border-color: rgba(0, 0, 0, 0.1);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 20% 30%, rgba(20, 184, 166, 0.15) 0%, transparent 50%),
                  radial-gradient(circle at 80% 70%, rgba(147, 51, 234, 0.15) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 1;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 64px;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-color);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 2rem;
      z-index: 100;
    }

    .header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .btn {
      padding: 0.625rem 1.25rem;
      border: none;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(233, 30, 140, 0.4);
    }

    .theme-toggle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      transform: rotate(20deg);
      border-color: var(--accent-pink);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      margin-top: 64px;
      overflow: hidden;
    }

    /* Task Board Section */
    .task-board {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }

    .board-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .board-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .kanban-board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      min-height: 500px;
    }

    .kanban-column {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 1rem;
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      max-height: calc(100vh - 200px);
    }

    .column-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--border-color);
    }

    .column-title {
      font-weight: 600;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .column-count {
      background: var(--bg-secondary);
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .column-tasks {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .task-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1rem;
      cursor: move;
      transition: all 0.3s ease;
    }

    .task-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
      border-color: var(--accent-pink);
    }

    .task-card.dragging {
      opacity: 0.5;
    }

    .task-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
    }

    .task-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .task-actions {
      display: flex;
      gap: 0.5rem;
    }

    .task-action-btn {
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 1rem;
      padding: 0.25rem;
      transition: all 0.2s ease;
    }

    .task-action-btn:hover {
      color: var(--accent-pink);
    }

    .task-title {
      font-weight: 600;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .task-title.editable {
      border: 1px solid var(--accent-pink);
      padding: 0.25rem;
      border-radius: 4px;
      outline: none;
      background: var(--bg-card);
    }

    .task-description {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
    }

    .task-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .task-assignee {
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .task-deadline {
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .task-deadline.overdue {
      color: var(--warning);
    }

    /* Chat Sidebar */
    .chat-sidebar {
      width: 380px;
      background: var(--bg-card);
      border-left: 1px solid var(--border-color);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .chat-title {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .channel-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .channel-btn {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      padding: 0.625rem;
      border-radius: 6px;
      cursor: pointer;
      text-align: left;
      font-size: 0.875rem;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .channel-btn:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .channel-btn.active {
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
      color: white;
    }

    .chat-messages {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .message {
      display: flex;
      gap: 0.75rem;
    }

    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
      flex-shrink: 0;
    }

    .message-content {
      flex: 1;
    }

    .message-header {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
      margin-bottom: 0.25rem;
    }

    .message-author {
      font-weight: 600;
      font-size: 0.875rem;
    }

    .message-time {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .message-text {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .chat-input-container {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border-color);
    }

    .chat-input-wrapper {
      display: flex;
      gap: 0.75rem;
    }

    .chat-input {
      flex: 1;
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 0.875rem;
      resize: none;
      font-family: inherit;
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--accent-pink);
      box-shadow: 0 0 0 3px rgba(233, 30, 140, 0.1);
    }

    .send-btn {
      padding: 0.75rem 1.25rem;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .send-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(233, 30, 140, 0.4);
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 2rem;
      width: 90%;
      max-width: 500px;
      backdrop-filter: blur(10px);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .close-btn {
      background: transparent;
      border: none;
      color: var(--text-muted);
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .close-btn:hover {
      color: var(--accent-pink);
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 0.875rem;
      font-family: inherit;
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--accent-pink);
      box-shadow: 0 0 0 3px rgba(233, 30, 140, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-card-hover);
      border-color: var(--accent-pink);
    }

    /* Mobile Responsive */
    @media (max-width: 1024px) {
      .kanban-board {
        grid-template-columns: 1fr;
      }

      .chat-sidebar {
        position: fixed;
        right: -100%;
        top: 64px;
        bottom: 0;
        transition: right 0.3s ease;
        z-index: 50;
      }

      .chat-sidebar.open {
        right: 0;
      }

      .mobile-chat-toggle {
        display: flex !important;
      }
    }

    .mobile-chat-toggle {
      display: none;
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
      color: white;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: var(--shadow);
      z-index: 40;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent-pink);
    }
  </style>
</head>
<body>
  
  <header class="header">
    <h1>Task & Communication Hub</h1>
    <div class="header-actions">
      <button class="btn btn-primary" onclick="openAddTaskModal()">
        <span>+</span>
        <span>Add Task</span>
      </button>
      <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
        <span id="themeIcon">☀️</span>
      </button>
    </div>
  </header>

  <div class="container">
     
    <div class="task-board">
      <div class="board-header">
        <h2 class="board-title">Task Board</h2>
      </div>

      <div class="kanban-board">
       
        <div class="kanban-column" data-column="todo">
          <div class="column-header">
            <span class="column-title">
              📋 To-Do
            </span>
            <span class="column-count" id="todoCount">0</span>
          </div>
          <div class="column-tasks" id="todoTasks">
             Tasks will be added here dynamically 
          </div>
        </div>

         
        <div class="kanban-column" data-column="inprogress">
          <div class="column-header">
            <span class="column-title">
              🚀 In Progress
            </span>
            <span class="column-count" id="inprogressCount">0</span>
          </div>
          <div class="column-tasks" id="inprogressTasks">
             Tasks will be added here dynamically 
          </div>
        </div>

         
        <div class="kanban-column" data-column="completed">
          <div class="column-header">
            <span class="column-title">
              ✅ Completed
            </span>
            <span class="column-count" id="completedCount">0</span>
          </div>
          <div class="column-tasks" id="completedTasks">
             
          </div>
        </div>
      </div>
    </div>

      
    <aside class="chat-sidebar" id="chatSidebar">
      <div class="chat-header">
        <h3 class="chat-title">Communications</h3>
        <div class="channel-list">
          <button class="channel-btn active" data-channel="organizers" onclick="switchChannel(this, 'organizers')">
            # organizers
          </button>
          <button class="channel-btn" data-channel="vendors" onclick="switchChannel(this, 'vendors')">
            # vendors
          </button>
          <button class="channel-btn" data-channel="attendees" onclick="switchChannel(this, 'attendees')">
            # attendees
          </button>
          <button class="channel-btn" data-channel="general" onclick="switchChannel(this, 'general')">
            # general
          </button>
        </div>
      </div>

      <div class="chat-messages" id="chatMessages">
         
      </div>

      <div class="chat-input-container">
        <div class="chat-input-wrapper">
          <textarea 
            class="chat-input" 
            id="messageInput" 
            placeholder="Type a message..."
            rows="1"
            onkeypress="handleMessageKeyPress(event)"
          ></textarea>
          <button class="send-btn" onclick="sendMessage()">Send</button>
        </div>
      </div>
    </aside>
  </div>

   
  <button class="mobile-chat-toggle" onclick="toggleMobileChat()">💬</button>

   
  <div class="modal" id="taskModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Add New Task</h3>
        <button class="close-btn" onclick="closeTaskModal()">&times;</button>
      </div>
      <form id="taskForm" onsubmit="saveTask(event)">
        <div class="form-group">
          <label class="form-label" for="taskTitle">Task Title</label>
          <input type="text" id="taskTitle" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="taskDescription">Description</label>
          <textarea id="taskDescription" class="form-textarea"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label" for="taskAssignee">Assign To</label>
          <select id="taskAssignee" class="form-select" required>
            <option value="">Select team member</option>
            <option value="John Doe">John Doe</option>
            <option value="Jane Smith">Jane Smith</option>
            <option value="Mike Johnson">Mike Johnson</option>
            <option value="Sarah Williams">Sarah Williams</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="taskDeadline">Deadline</label>
          <input type="date" id="taskDeadline" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="taskStatus">Status</label>
          <select id="taskStatus" class="form-select" required>
            <option value="todo">To-Do</option>
            <option value="inprogress">In Progress</option>
            <option value="completed">Completed</option>
          </select>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeTaskModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Task</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Task Management
    let tasks = [];
    let currentChannel = 'organizers';
    let editingTaskId = null;

    // Initialize with sample tasks
    function initializeTasks() {
      tasks = [
        {
          id: Date.now() + 1,
          title: 'Finalize venue contract',
          description: 'Review and sign the venue rental agreement',
          assignee: 'John Doe',
          deadline: '2025-10-15',
          status: 'todo',
          completed: false
        },
        {
          id: Date.now() + 2,
          title: 'Confirm catering menu',
          description: 'Finalize menu options with catering vendor',
          assignee: 'Jane Smith',
          deadline: '2025-10-10',
          status: 'inprogress',
          completed: false
        },
        {
          id: Date.now() + 3,
          title: 'Send invitations',
          description: 'Send event invitations to all attendees',
          assignee: 'Mike Johnson',
          deadline: '2025-10-05',
          status: 'completed',
          completed: true
        }
      ];
      renderTasks();
    }

    // Render all tasks
    function renderTasks() {
      const todoContainer = document.getElementById('todoTasks');
      const inprogressContainer = document.getElementById('inprogressTasks');
      const completedContainer = document.getElementById('completedTasks');

      todoContainer.innerHTML = '';
      inprogressContainer.innerHTML = '';
      completedContainer.innerHTML = '';

      let todoCount = 0;
      let inprogressCount = 0;
      let completedCount = 0;

      tasks.forEach(task => {
        const taskElement = createTaskElement(task);
        
        if (task.status === 'todo') {
          todoContainer.appendChild(taskElement);
          todoCount++;
        } else if (task.status === 'inprogress') {
          inprogressContainer.appendChild(taskElement);
          inprogressCount++;
        } else if (task.status === 'completed') {
          completedContainer.appendChild(taskElement);
          completedCount++;
        }
      });

      document.getElementById('todoCount').textContent = todoCount;
      document.getElementById('inprogressCount').textContent = inprogressCount;
      document.getElementById('completedCount').textContent = completedCount;
    }

    // Create task element
    function createTaskElement(task) {
      const taskCard = document.createElement('div');
      taskCard.className = 'task-card';
      taskCard.draggable = true;
      taskCard.dataset.taskId = task.id;

      const isOverdue = new Date(task.deadline) < new Date() && !task.completed;

      taskCard.innerHTML = `
        <div class="task-header">
          <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} 
                 onchange="toggleTaskComplete(${task.id})">
          <div class="task-actions">
            <button class="task-action-btn" onclick="editTask(${task.id})" title="Edit">✏️</button>
            <button class="task-action-btn" onclick="deleteTask(${task.id})" title="Delete">🗑️</button>
          </div>
        </div>
        <div class="task-title" ondblclick="enableInlineEdit(this, ${task.id})">${task.title}</div>
        <div class="task-description">${task.description}</div>
        <div class="task-meta">
          <div class="task-assignee">
            <span>👤</span>
            <span>${task.assignee}</span>
          </div>
          <div class="task-deadline ${isOverdue ? 'overdue' : ''}">
            <span>📅</span>
            <span>${new Date(task.deadline).toLocaleDateString()}</span>
          </div>
        </div>
      `;

      // Drag and drop events
      taskCard.addEventListener('dragstart', handleDragStart);
      taskCard.addEventListener('dragend', handleDragEnd);

      return taskCard;
    }

    // Drag and drop handlers
    let draggedTask = null;

    function handleDragStart(e) {
      draggedTask = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    }

    function handleDragEnd(e) {
      this.classList.remove('dragging');
    }

    // Enable drag and drop on columns
    document.querySelectorAll('.column-tasks').forEach(column => {
      column.addEventListener('dragover', e => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
      });

      column.addEventListener('drop', e => {
        e.preventDefault();
        if (draggedTask) {
          const taskId = parseInt(draggedTask.dataset.taskId);
          const newStatus = column.closest('.kanban-column').dataset.column;
          updateTaskStatus(taskId, newStatus);
        }
      });
    });

    // Update task status
    function updateTaskStatus(taskId, newStatus) {
      const task = tasks.find(t => t.id === taskId);
      if (task) {
        task.status = newStatus;
        if (newStatus === 'completed') {
          task.completed = true;
        }
        renderTasks();
      }
    }

    // Toggle task completion
    function toggleTaskComplete(taskId) {
      const task = tasks.find(t => t.id === taskId);
      if (task) {
        task.completed = !task.completed;
        if (task.completed && task.status !== 'completed') {
          task.status = 'completed';
        } else if (!task.completed && task.status === 'completed') {
          task.status = 'inprogress';
        }
        renderTasks();
      }
    }

    // Inline editing
    function enableInlineEdit(element, taskId) {
      const originalText = element.textContent;
      element.contentEditable = true;
      element.classList.add('editable');
      element.focus();

      element.addEventListener('blur', function() {
        element.contentEditable = false;
        element.classList.remove('editable');
        const newTitle = element.textContent.trim();
        if (newTitle && newTitle !== originalText) {
          const task = tasks.find(t => t.id === taskId);
          if (task) {
            task.title = newTitle;
          }
        } else {
          element.textContent = originalText;
        }
      }, { once: true });

      element.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          element.blur();
        }
      });
    }

    // Modal functions
    function openAddTaskModal() {
      editingTaskId = null;
      document.getElementById('modalTitle').textContent = 'Add New Task';
      document.getElementById('taskForm').reset();
      document.getElementById('taskModal').classList.add('active');
    }

    function closeTaskModal() {
      document.getElementById('taskModal').classList.remove('active');
      editingTaskId = null;
    }

    function editTask(taskId) {
      const task = tasks.find(t => t.id === taskId);
      if (!task) return;

      editingTaskId = taskId;
      document.getElementById('modalTitle').textContent = 'Edit Task';
      document.getElementById('taskTitle').value = task.title;
      document.getElementById('taskDescription').value = task.description;
      document.getElementById('taskAssignee').value = task.assignee;
      document.getElementById('taskDeadline').value = task.deadline;
      document.getElementById('taskStatus').value = task.status;
      document.getElementById('taskModal').classList.add('active');
    }

    function saveTask(e) {
      e.preventDefault();

      const taskData = {
        title: document.getElementById('taskTitle').value,
        description: document.getElementById('taskDescription').value,
        assignee: document.getElementById('taskAssignee').value,
        deadline: document.getElementById('taskDeadline').value,
        status: document.getElementById('taskStatus').value,
        completed: document.getElementById('taskStatus').value === 'completed'
      };

      if (editingTaskId) {
        const task = tasks.find(t => t.id === editingTaskId);
        if (task) {
          Object.assign(task, taskData);
        }
      } else {
        tasks.push({
          id: Date.now(),
          ...taskData
        });
      }

      renderTasks();
      closeTaskModal();
    }

    function deleteTask(taskId) {
      if (confirm('Are you sure you want to delete this task?')) {
        tasks = tasks.filter(t => t.id !== taskId);
        renderTasks();
      }
    }

    // Chat Management
    const channelMessages = {
      organizers: [
        { author: 'John Doe', time: '10:30 AM', text: 'Team meeting at 3 PM today!' },
        { author: 'Jane Smith', time: '10:45 AM', text: 'Sounds good, I\'ll be there.' }
      ],
      vendors: [
        { author: 'Catering Co.', time: '09:15 AM', text: 'Menu finalized and sent for approval.' }
      ],
      attendees: [
        { author: 'Mike Johnson', time: '11:20 AM', text: 'Looking forward to the event!' }
      ],
      general: [
        { author: 'Sarah Williams', time: '08:00 AM', text: 'Good morning everyone!' }
      ]
    };

    function renderMessages() {
      const container = document.getElementById('chatMessages');
      const messages = channelMessages[currentChannel] || [];
      
      container.innerHTML = messages.map(msg => `
        <div class="message">
          <div class="message-avatar">${msg.author.charAt(0)}</div>
          <div class="message-content">
            <div class="message-header">
              <span class="message-author">${msg.author}</span>
              <span class="message-time">${msg.time}</span>
            </div>
            <div class="message-text">${msg.text}</div>
          </div>
        </div>
      `).join('');

      container.scrollTop = container.scrollHeight;
    }

    function switchChannel(button, channel) {
      document.querySelectorAll('.channel-btn').forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
      currentChannel = channel;
      renderMessages();
    }

    function sendMessage() {
      const input = document.getElementById('messageInput');
      const text = input.value.trim();
      
      if (!text) return;

      if (!channelMessages[currentChannel]) {
        channelMessages[currentChannel] = [];
      }

      channelMessages[currentChannel].push({
        author: 'You',
        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
        text: text
      });

      input.value = '';
      renderMessages();
    }

    function handleMessageKeyPress(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    }

    // Mobile chat toggle
    function toggleMobileChat() {
      document.getElementById('chatSidebar').classList.toggle('open');
    }

    // Theme Toggle
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', newTheme);
      document.getElementById('themeIcon').textContent = newTheme === 'light' ? '🌙' : '☀️';
      localStorage.setItem('theme', newTheme);
    }

    // Load saved theme
    window.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      document.getElementById('themeIcon').textContent = savedTheme === 'light' ? '🌙' : '☀️';
      
      initializeTasks();
      renderMessages();
    });

    // Close modal on outside click
    document.getElementById('taskModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeTaskModal();
      }
    });
  </script>
</body>
</html>